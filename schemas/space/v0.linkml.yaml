id: https://github.com/nclack/noid/schemas/space/v0.linkml
name: space
title: Coordinate Spaces and Dimensions Schema
description: >-
  Schema for defining coordinate systems, dimensions, and coordinate transforms
  for multidimensional array data.
version: 0.1.0
license: MIT

prefixes:
  linkml: https://w3id.org/linkml/
  noid_spaces: https://github.com/nclack/noid/schemas/space/
  noid_transform: https://github.com/nclack/noid/schemas/transform/
  xsd: http://www.w3.org/2001/XMLSchema#

default_prefix: noid_spaces
default_range: string

imports:
  - linkml:types
  - ../sampler/v0.linkml
  - ../transform/v0.linkml

classes:
  Dimension:
    description: >-
      A single axis within a coordinate space with its measurement unit and classification.

      The type field is optional and can be inferred from the unit in many cases:
      - Spatial units (m, mm, µm, nm, etc.) → "space"
      - Temporal units (s, ms, µs, etc.) → "time"
      - "index" unit → "index"
      - "arbitrary" unit → "other"
      - Other physical units → "other"

      When type is provided, it overrides the inferred type. This allows for cases like
      using "nm" for wavelength channels instead of spatial dimensions.
    attributes:
      id:
        description: Unique identifier for the dimension
        identifier: true
        required: true
        pattern: "^.+$"  # Non-empty string
        annotations:
          jsonld.id: "@id"
      unit:
        description: Unit of measurement from the noid-spaces unit vocabulary or non-physical units
        required: true
        range: UnitTerm
      type:
        description: >-
          Dimension type classification. Optional - if not provided, will be inferred
          from the unit based on its physical dimensionality.
        required: false
        range: DimensionType
    rules:
      - title: Index type must have index unit
        description: If type is "index", then unit MUST be "index"
        preconditions:
          slot_conditions:
            type:
              equals_string: "index"
        postconditions:
          slot_conditions:
            unit:
              equals_string: "index"

  CoordinateSystem:
    description: >-
      Collection of dimensions that together define a coordinate space for positioning data elements.
    attributes:
      id:
        description: Unique identifier for the coordinate system
        identifier: true
        required: true
        pattern: "^.+$"  # Non-empty string
      dimensions:
        description: List of dimension specifications
        required: true
        multivalued: true
        minimum_cardinality: 1
        range: DimensionSpec
      description:
        description: Optional description of the coordinate system
        pattern: "^.+$"  # Non-empty string if present

  CoordinateTransform:
    description: >-
      Mathematical mapping between input and output coordinate spaces with transform definition.
    attributes:
      id:
        description: Unique identifier for the coordinate transform
        identifier: true
        required: true
        pattern: "^.+$"  # Non-empty string
      input:
        description: Input coordinate space specification
        required: true
        range: CoordinateSpaceSpec
      output:
        description: Output coordinate space specification
        required: true
        range: CoordinateSpaceSpec
      transform:
        description: Transform definition from noid_transform schema
        required: true
        range: Transform
      description:
        description: Optional description of the coordinate transform
        pattern: "^.+$"  # Non-empty string if present

  # Union types for flexible specifications
  DimensionSpec:
    description: >-
      Dimension specification that can be either a string reference or inline Dimension object.
    union_of:
      - string
      - Dimension

  CoordinateSpaceSpec:
    description: >-
      Coordinate space specification that can be a string reference, dimension array, or inline CoordinateSystem.
    union_of:
      - string
      - DimensionArray
      - CoordinateSystem

  DimensionArray:
    description: Array of dimension specifications
    attributes:
      dimensions:
        multivalued: true
        minimum_cardinality: 1
        range: DimensionSpec

types:
  UnitTerm:
    description: >-
      Unit specification from the noid-spaces unit vocabulary. This includes all Pint default units
      plus biomedical extensions and non-physical units (index, arbitrary) defined in units.txt.
      All units are validated via the Pint registry.
      Extended definitions: https://github.com/nclack/noid/blob/main/packages/noid-spaces/units.txt
    typeof: string
    pattern: "^.+$"  # Non-empty string

enums:
  DimensionType:
    description: Classification of dimension types
    permissible_values:
      space:
        description: Spatial dimensions
        meaning: noid_spaces:SpatialDimension
      time:
        description: Temporal dimensions
        meaning: noid_spaces:TemporalDimension
      other:
        description: Channels, indices, categories
        meaning: noid_spaces:OtherDimension
      index:
        description: Array index dimensions
        meaning: noid_spaces:IndexDimension

# Non-physical units (index, arbitrary) are now defined in units.txt alongside physical units
